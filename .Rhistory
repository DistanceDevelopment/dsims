cov.params <- list(size = log(0.98),
sex = data.frame(level = c("male", "female"),
param = c(log(1), log(0.6))))
detect <- make.detectability(key.function = "hn",
scale.param = 15,
truncation = 25,
cov.param = cov.params)
plot(detect, pop.descrp)
cover <- make.coverage(region = region,
n.grid.points = 100)
design <- make.design(region = region,
transect.type = "line",
design = "systematic",
samplers = 20,
edge.protocol = "minus",
bounding.shape = "rectangle",
truncation = 25,
coverage.grid = cover)
plot(region)
plot(density)
pop <- generate.population(pop.descrp, detect, region)
transects <- generate.transects(design)
plot(region, transects, covered.area = TRUE)
plot(pop)
survey <- new(Class = "Survey.LT",
population = pop,
transect = transects,
perp.truncation = detect@truncation)
survey <- run.survey(survey, region)
hist(survey@dist.data$distance)
ds.analysis <- make.ds.analysis(dsmodel = list(~1),
key = "hn",
truncation = 400)
ds.model <- analyse.data(ds.analysis, data.obj = survey)
ds.model$model$dht
ds.analysis <- make.ds.analysis(dsmodel = list(~size),
key = "hn",
truncation = 400)
ds.model <- analyse.data(ds.analysis, data.obj = survey)
dsmodel
ds.model
ds.model$model$ddf
cov.params <- list(size = log(1.2),
sex = data.frame(level = c("male", "female"),
param = c(log(1), log(0.6))))
detect <- make.detectability(key.function = "hn",
scale.param = 5,
truncation = 25,
cov.param = cov.params)
plot(detect, pop.descrp)
plot(detect, pop.descrp)
cov.params <- list(size = log(1.1),
sex = data.frame(level = c("male", "female"),
param = c(log(1), log(0.6))))
detect <- make.detectability(key.function = "hn",
scale.param = 5,
truncation = 25,
cov.param = cov.params)
plot(detect, pop.descrp)
cov.params <- list(size = log(1.05),
sex = data.frame(level = c("male", "female"),
param = c(log(1), log(0.8))))
detect <- make.detectability(key.function = "hn",
scale.param = 5,
truncation = 25,
cov.param = cov.params)
plot(detect, pop.descrp)
cov.params <- list(size = log(1.05),
sex = data.frame(level = c("male", "female"),
param = c(log(1), log(1))))
detect <- make.detectability(key.function = "hn",
scale.param = 5,
truncation = 25,
cov.param = cov.params)
plot(detect, pop.descrp)
cov.params <- list(size = log(1.05),
sex = data.frame(level = c("male", "female"),
param = c(log(1), log(1.1))))
detect <- make.detectability(key.function = "hn",
scale.param = 5,
truncation = 25,
cov.param = cov.params)
plot(detect, pop.descrp)
cov.params <- list(size = log(1.05),
sex = data.frame(level = c("male", "female"),
param = c(log(1), log(1.3)))
detect <- make.detectability(key.function = "hn",
scale.param = 5,
truncation = 25,
cov.param = cov.params)
plot(detect, pop.descrp)
cov.params <- list(size = log(1.05),
sex = data.frame(level = c("male", "female"),
param = c(log(1), log(1.3)))
cov.params <- list(size = log(1.05),
sex = data.frame(level = c("male", "female"),
param = c(log(1), log(1.3))))
detect <- make.detectability(key.function = "hn",
scale.param = 5,
truncation = 25,
cov.param = cov.params)
plot(detect, pop.descrp)
cov.params <- list(size = log(1.05),
sex = data.frame(level = c("male", "female"),
param = c(log(1), log(1.3))))
detect <- make.detectability(key.function = "hn",
scale.param = 5,
truncation = 25,
cov.param = cov.params)
plot(detect, pop.descrp)
cov.params <- list(size = log(1.05),
sex = data.frame(level = c("male", "female"),
param = c(log(1), log(1.4))))
detect <- make.detectability(key.function = "hn",
scale.param = 5,
truncation = 25,
cov.param = cov.params)
plot(detect, pop.descrp)
cov.params <- list(size = log(1.05),
sex = data.frame(level = c("male", "female"),
param = c(log(1), log(1.5))))
detect <- make.detectability(key.function = "hn",
scale.param = 5,
truncation = 25,
cov.param = cov.params)
plot(detect, pop.descrp)
cov.params <- list(size = log(1.02),
sex = data.frame(level = c("male", "female"),
param = c(log(1), log(1.5))))
detect <- make.detectability(key.function = "hn",
scale.param = 5,
truncation = 25,
cov.param = cov.params)
plot(detect, pop.descrp)
cov.params <- list(size = log(1.04),
sex = data.frame(level = c("male", "female"),
param = c(log(1), log(1.5))))
detect <- make.detectability(key.function = "hn",
scale.param = 5,
truncation = 25,
cov.param = cov.params)
plot(detect, pop.descrp)
cov.params <- list(size = log(1.05),
sex = data.frame(level = c("male", "female"),
param = c(log(1), log(1.5))))
detect <- make.detectability(key.function = "hn",
scale.param = 5,
truncation = 25,
cov.param = cov.params)
plot(detect, pop.descrp)
cov.params <- list(size = log(1.05),
sex = data.frame(level = c("male", "female"),
param = c(log(1), log(1.5))))
detect <- make.detectability(key.function = "hn",
scale.param = 5,
truncation = 25,
cov.param = cov.params)
plot(detect, pop.descrp)
cov.params <- list(size = log(1.05),
sex = data.frame(level = c("male", "female"),
param = c(log(1), log(1.5))))
detect <- make.detectability(key.function = "hn",
scale.param = 5,
truncation = 25,
cov.param = cov.params)
plot(detect, pop.descrp)
cov.params <- list(size = log(1.05),
sex = data.frame(level = c("male", "female"),
param = c(log(1), log(1.5))))
detect <- make.detectability(key.function = "hn",
scale.param = 5,
truncation = 25,
cov.param = cov.params)
plot(detect, pop.descrp)
cov.params <- list(size = log(1.05),
sex = data.frame(level = c("male", "female"),
param = c(log(1), log(1.5))))
detect <- make.detectability(key.function = "hn",
scale.param = 5,
truncation = 25,
cov.param = cov.params)
plot(detect, pop.descrp)
cover <- make.coverage(region = region,
n.grid.points = 100)
design <- make.design(region = region,
transect.type = "line",
design = "systematic",
samplers = 20,
edge.protocol = "minus",
bounding.shape = "rectangle",
truncation = 25,
coverage.grid = cover)
plot(region)
plot(density)
pop <- generate.population(pop.descrp, detect, region)
transects <- generate.transects(design)
plot(region, transects, covered.area = TRUE)
plot(pop)
survey <- new(Class = "Survey.LT",
population = pop,
transect = transects,
perp.truncation = detect@truncation)
survey <- run.survey(survey, region)
hist(survey@dist.data$distance)
ds.analysis <- make.ds.analysis(dsmodel = list(~size),
key = "hn",
truncation = 25)
test <- Distance::ds(survey@dist.data,
truncation = 25,
formula = ~size)
ds.model <- analyse.data(ds.analysis, data.obj = survey)
summary(ds.model$model$ddf)
summary(test)
summary(test$ddf)
ds.analysis <- make.ds.analysis(dsmodel = list(~size),
key = "hn",
truncation = 25)
ds.model <- analyse.data(ds.analysis, data.obj = survey)
test <- Distance::ds(survey@dist.data,
truncation = 25,
key = "hn"
formula = ~size)
ds.analysis <- make.ds.analysis(dsmodel = list(~size),
key = "hn",
truncation = 25)
ds.model <- analyse.data(ds.analysis, data.obj = survey)
test <- Distance::ds(survey@dist.data,
truncation = 25,
key = "hn",
formula = ~size)
ds.model$model$ddf
test$ddf
AIC(ds.model)$AIC
AIC(ds.model$model)$AIC
n <- length(ds.model$model$ddf$fitted)
k <- length(ds.model$model$ddf$par)
n
k
(2*k^2 + 2*k)/(n-k-1)
n <- 3:1000
test <- (2*k^2 + 2*k)/(n-k-1)
plot(test)
n <- 3:500
test <- (2*k^2 + 2*k)/(n-k-1)
plot(test, type= "l")
n <- 3:100
test <- (2*k^2 + 2*k)/(n-k-1)
plot(test, type= "l")
ds.analysis <- make.ds.analysis(dsmodel = list(~1, ~size, ~size+sex),
key = rep("hn",3),
truncation = 25)
ds.model.sel <- analyse.data(ds.analysis, data.obj = survey)
ds.model.sel
ds.model.sel$warnings
dist.data <- survey@dist.data
args <- list()
analysis <- ds.model.sel
if(!"transect" %in% names(args)){
#assume it is a line transect if it is missing
transect <- "line"
}else{
transect <- args$transect
}
transect
length(analysis@adjustment)
class(ds.model.sel)
ds.model.sel
analysis <- ds.analysis
if(length(analysis@adjustment) == 0){
adjustment <- NULL
order <- NULL
scale <- NULL
max.adjustments <- 0
}else{
adjustment <- analysis@adjustment$adjustment
order <- analysis@adjustment$order
scale <- analysis@adjustment$scale
max.adjustments <- analysis@adjustment$max.adjustments
}
transect
if("monotonicity" %in% names(analysis@control.opts)){
monotonicity <- analysis@control.opts$monotonicity
}else{
monotonicity <- ifelse(analysis@dsmodel == ~1, "strict", "none")
}
"monotonicity" %in% names(analysis@control.opts)
analysis@dsmodel
ifelse(analysis@dsmodel == ~1, "strict", "none")
analysis@dsmodel[[1]] == ~1
analysis@dsmodel[[2]] == ~1
analysis@dsmodel[[3]] == ~1
ifelse(analysis@dsmodel == ~1, "strict", "none")
ifelse(unlist(analysis@dsmodel) == ~1, "strict", "none")
unlist(analysis@dsmodel)
for(i in seq(along = analysis@dsmodel)){
monotonicity[i] <- ifelse(analysis@dsmodel[i] == ~1, "strict", "none")
}
monotonicity
if("method" %in% names(analysis@control.opts)){
method <- analysis@control.opts$method
}else{
method <- "nlminb"
}
method
analysis@truncation
if(length(analysis@truncation[[1]] == 1)){
truncation <- analysis@truncation[[1]]
}else{
truncation <- analysis@truncation
}
if(length(analysis@cutpoints) > 0){
# bin data
dist.data <- dist.data[dist.data$distance <= max(object@cutpoints),]
dist.data <- create.bins(dist.data, cutpoints = object@cutpoints)
}
models <- list()
IC <- numeric()
seq(along = analysis@dsmodel)
i = 1
# Set W to null
W <- NULL
# Try to fit model
models[[i]] <- suppressMessages(
withCallingHandlers(tryCatch(Distance::ds(data = dist.data,
truncation = truncation,
transect = transect,
formula = analysis@dsmodel[[i]],
key = analysis@key[i],
adjustment = adjustment[i],
order = order[i],
scale = scale[i],
cutpoints = NULL, #analysis@cutpoints,
monotonicity = monotonicity[i],
er.var = analysis@er.var,
method = method,
max.adjustments = max.adjustments[i]),
error=function(e)e),
warning=function(w){W <<- w; invokeRestart("muffleWarning")}))
#check if there was an error, warning or non-convergence
if(any(class(models[[i]]) == "error")){
warnings <- message.handler(warnings, paste("Error: ", models[[i]]$message, " (Model number: ", i, ")", sep = ""))
models[[i]] <- NA
}else if(models[[i]]$ddf$ds$converge != 0){
warnings <- message.handler(warnings, paste("The following model failed to converge: ", i, sep = ""))
models[[i]] <- NA
}else if(any(predict(models[[i]])$fitted < 0)){
warnings <- message.handler(warnings, paste("Negative predictions for model ", i,", excluding these results."), sep = "")
ddf.result <- NA
}
if(!is.null(W)){
warnings <- message.handler(warnings, paste(W, " (Model number: ", i, ")", sep = ""))
}
if(class(models[[i]]) == "dsmodel"){
IC[i] <- switch(analysis@criteria,
"AIC" = AIC(models[[i]])$AIC,
"BIC" = BIC(models[[i]]))
}
IC
models[[i]]$ddf
i=2
# Set W to null
W <- NULL
# Try to fit model
models[[i]] <- suppressMessages(
withCallingHandlers(tryCatch(Distance::ds(data = dist.data,
truncation = truncation,
transect = transect,
formula = analysis@dsmodel[[i]],
key = analysis@key[i],
adjustment = adjustment[i],
order = order[i],
scale = scale[i],
cutpoints = NULL, #analysis@cutpoints,
monotonicity = monotonicity[i],
er.var = analysis@er.var,
method = method,
max.adjustments = max.adjustments[i]),
error=function(e)e),
warning=function(w){W <<- w; invokeRestart("muffleWarning")}))
models[[2]]$call
analysis@dsmodel[[i]]
analysis@key[i]
adjustment[i]
adjustment[1]
order[i]
monotonicity[i]
max.adjustments[i]
models[[i]] <- suppressMessages(
withCallingHandlers(tryCatch(Distance::ds(data = dist.data,
truncation = truncation,
transect = transect,
formula = analysis@dsmodel[[i]],
key = analysis@key[i],
adjustment = adjustment[i],
order = order[i],
scale = scale[i],
cutpoints = NULL, #analysis@cutpoints,
monotonicity = monotonicity[i],
er.var = analysis@er.var,
method = method,
max.adjustments = max.adjustments),
error=function(e)e),
warning=function(w){W <<- w; invokeRestart("muffleWarning")}))
#check if there was an error, warning or non-convergence
models[[2]]$ddf
if(any(class(models[[i]]) == "error")){
warnings <- message.handler(warnings, paste("Error: ", models[[i]]$message, " (Model number: ", i, ")", sep = ""))
models[[i]] <- NA
}else if(models[[i]]$ddf$ds$converge != 0){
warnings <- message.handler(warnings, paste("The following model failed to converge: ", i, sep = ""))
models[[i]] <- NA
}else if(any(predict(models[[i]])$fitted < 0)){
warnings <- message.handler(warnings, paste("Negative predictions for model ", i,", excluding these results."), sep = "")
ddf.result <- NA
}
if(!is.null(W)){
warnings <- message.handler(warnings, paste(W, " (Model number: ", i, ")", sep = ""))
}
if(class(models[[i]]) == "dsmodel"){
IC[i] <- switch(analysis@criteria,
"AIC" = AIC(models[[i]])$AIC,
"BIC" = BIC(models[[i]]))
}
source('~/Documents/GitHub/dsims/dsims/R/AICc.R')
IC
i=3
# Set W to null
W <- NULL
# Try to fit model
models[[i]] <- suppressMessages(
withCallingHandlers(tryCatch(Distance::ds(data = dist.data,
truncation = truncation,
transect = transect,
formula = analysis@dsmodel[[i]],
key = analysis@key[i],
adjustment = adjustment[i],
order = order[i],
scale = scale[i],
cutpoints = NULL, #analysis@cutpoints,
monotonicity = monotonicity[i],
er.var = analysis@er.var,
method = method,
max.adjustments = max.adjustments),
error=function(e)e),
warning=function(w){W <<- w; invokeRestart("muffleWarning")}))
#check if there was an error, warning or non-convergence
if(any(class(models[[i]]) == "error")){
warnings <- message.handler(warnings, paste("Error: ", models[[i]]$message, " (Model number: ", i, ")", sep = ""))
models[[i]] <- NA
}else if(models[[i]]$ddf$ds$converge != 0){
warnings <- message.handler(warnings, paste("The following model failed to converge: ", i, sep = ""))
models[[i]] <- NA
}else if(any(predict(models[[i]])$fitted < 0)){
warnings <- message.handler(warnings, paste("Negative predictions for model ", i,", excluding these results."), sep = "")
ddf.result <- NA
}
if(!is.null(W)){
warnings <- message.handler(warnings, paste(W, " (Model number: ", i, ")", sep = ""))
}
if(class(models[[i]]) == "dsmodel"){
IC[i] <- switch(analysis@criteria,
"AIC" = AIC(models[[i]])$AIC,
"AICc" = AICc(models[[i]]),
"BIC" = BIC(models[[i]]))
}
IC
length(IC)
min.IC <- min(IC, na.rm = TRUE)
index <- which(IC == min.IC)
min.model <- models[[index]]
index
min.model$ddf
library(dsims)
ds.analysis.sel <- make.ds.analysis(dsmodel = list(~1, ~size, ~size+sex),
key = rep("hn",3),
truncation = 25)
best.model <- analyse.data(ds.analysis.sel, data.obj = survey)
best.model$model$ddf
library(dsims)
ds.analysis.sel <- make.ds.analysis(dsmodel = list(~1, ~size, ~size+sex),
key = rep("hn",3),
truncation = 25)
best.model <- analyse.data(ds.analysis.sel, data.obj = survey)
ds.analysis.sel <- make.ds.analysis(dsmodel = list(~1, ~size, ~size+sex),
key = rep("hn",3),
truncation = 25)
best.model <- analyse.data(ds.analysis.sel, data.obj = survey)
best.model[[1]]
best.model[[1]][[1]]$ddf
best.model[[1]][[2]]$ddf
test <- Distance::ds(survey@dist.data,
truncation = 25,
key = "hn",
formula = ~size)
test$ddf
test <- Distance::ds(survey@dist.data,
truncation = 25,
key = "hn",
formula = ~size+sex)
test$ddf
design
design@region
?dssd::transects
?dssd::generate.transects
ls()
class(transects)
class(transects) == "Line.Transect"
ls()
ds.model$model$ddf
ds.model$model$dht
install.packages("pbapply")
37.99/2
