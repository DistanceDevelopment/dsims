<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Learning the distinction between the former simulation engine and the current simulation engine by using dsims to investigate truncation distances with individual level covariates
">
<title>Transition from `DSsim` to `dsims` • dsims</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.9/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Transition from `DSsim` to `dsims`">
<meta property="og:description" content="Learning the distinction between the former simulation engine and the current simulation engine by using dsims to investigate truncation distances with individual level covariates
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">dsims</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Function reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/GettingStarted.html">Getting started</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/dsims-examples.html">Transition from `DSsim` to `dsims`</a>
    <a class="dropdown-item" href="../articles/dsims_grouped_strata.html">Grouped strata</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://twitter.com/distancesamp" aria-label="Twitter">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/DistanceDevelopment/dsims/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Transition from `DSsim` to `dsims`</h1>
                        <h4 data-toc-skip class="author">L. Marshall</h4>
            <address class="author_afil">
      CREEM, Univ of St Andrews<br><h4 data-toc-skip class="date">May 2024</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/DistanceDevelopment/dsims/blob/HEAD/vignettes/dsims-examples.Rmd" class="external-link"><code>vignettes/dsims-examples.Rmd</code></a></small>
      <div class="d-none name"><code>dsims-examples.Rmd</code></div>
    </address>
</div>

    
    
<div class="section level2">
<h2 id="preamble">Preamble<a class="anchor" aria-label="anchor" href="#preamble"></a>
</h2>
<p>The first version of the simulation engine was a package called DSsim <span class="citation">(Marshall, 2019)</span>; with improving GIS capabilities in R we have later released a second more efficient simulation package, dsims <span class="citation">(Marshall, 2022a)</span>. This vignette was originally written for DSsim and so we use it now to not only demonstrate dsims but also as an example for users of DSsim showing how to transition to dsims. As the two packages have largely the same function names loading them together is not advised, this vignette will therefore leave the DSsim code in as comments for comparison with the dsims code. Please note that normal comments follow a single # and DSsim code follows double ##. It should also be noted that dsims now uses the distance sampling survey design package, dssd <span class="citation">(Marshall, 2022b)</span>, to generate the transects based on the design so that shapefiles containing the transects no longer need to be created in advance.</p>
<p>If your goal is to transition to dsims from DSsim then you will find all you need in the sections up to and including the section on running simulations. The latter sections go on to run a series of additional simulations investigating pooling robustness and covariate parameter estimation with respect to truncation distance. If you are completely new to distance sampling simulations then an alternative place to start is the Getting Started vignette inside the dsims package. This vignette uses dsims to compare a systematic parallel design with a zigzag design to assess the accuracy/precision trade off. To view this open R and after installing dsims, enter the following code:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"GettingStarted"</span>, package <span class="op">=</span> <span class="st">"dsims"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: vignette 'GettingStarted' not found</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Distance sampling is a process in which a study area is surveyed to estimate the size of the population within it. It can be thought of as an extension to plot sampling. However, while plot sampling assumes that all objects within the plots are detected, distance sampling relaxes this assumption. To do this Distance sampling makes an assumptions about the distribution of objects with respect to the transects and to satisfy these assumptions the transects (the points or lines) must be randomly located within the study region. Note that for the purposes of distance sampling an object can either be an individual or a cluster or individuals.</p>
<p>The next step in distance sampling is then to record the distances from each detected object to the transect it was detected from and fit a detection function. From this function we can estimate how many objects were missed and hence the total number in the covered area. For example, Figure <a href="#fig:detectionfunction">1</a> shows histograms of distances that might be collected on a line transect survey, with a fitted detection function. If the lines have been placed at random within the study region then we would expect on average the same number of object to occur at any given distance from the transect. Therefore the drop in number of detection with increasing distance from the line can be attributed to a failure to detect all objects. We can therefore estimate from this detection function that the probability of seeing an object within the covered region out to a chosen truncation distance is the area under the curve (shaded grey) divided by the area of the rectangle.</p>
<div class="figure">
<span style="display:block;" id="fig:detectionfunction"></span>
<img src="dsims-examples_files/figure-html/detectionfunction-1.png" alt="An example detection function. The histogram shows example distances recorded from a line transect. The smooth curve is the detection function. The grey shaded area represents the number of detected objects and the diagonal hash region represents the number of objects in the covered region that were not detected."><p class="caption">
Figure 1: An example detection function. The histogram shows example distances recorded from a line transect. The smooth curve is the detection function. The grey shaded area represents the number of detected objects and the diagonal hash region represents the number of objects in the covered region that were not detected.
</p>
</div>
<p>The R package dsims allows users to simulate both point and line transect surveys, and test out a range of design and analysis decisions specific to their population of interest. To simulate surveys the user must make some assumptions about the population of interest and the detection process giving rise to the observed distances. Simulations can be repeated over a range of assumptions so that the user can be confident that their chosen design will perform well despite any uncertainty.</p>
<div class="section level3">
<h3 id="introduction-to-dsims">Introduction to dsims<a class="anchor" aria-label="anchor" href="#introduction-to-dsims"></a>
</h3>
<p>dsims takes information from the user on the study region, population and detection process and uses it to generate distance sampling data. dsims can then be asked to fit detection functions to this data and produce estimates of density, abundance and the associated uncertainty. dsims splits this process into three stages. Firstly, it generates an instance of a population and a set of survey transects. Secondly, it simulates the distance sampling survey using the assumed detection function(s) provided by the user. Lastly, dsims analyses the data from the survey. Figure <a href="#fig:flowchart">2</a> illustrates the simulation process and highlights the information which must be provided by the user.</p>
<p>Distance sampling simulations can be very useful to researchers who wish to optimise their survey design for their specific study regions and species of interest in order to try and achieve the most accurate / precise estimates for their populations. Setting up and running such simulations to optimise a design is a very small cost in comparison to those associated with actually completing the survey!</p>
<div class="figure">
<span style="display:block;" id="fig:flowchart"></span>
<img src="SimulationDiagram.png" alt="Illustrates the simulation process. Blue rectangles indicate information supplied by the user. Green rectangles are objects created by dsims in the simulation process. Orange diamonds indicate the processes carried out by dsims." width="543"><p class="caption">
Figure 2: Illustrates the simulation process. Blue rectangles indicate information supplied by the user. Green rectangles are objects created by dsims in the simulation process. Orange diamonds indicate the processes carried out by dsims.
</p>
</div>
<p>dsims is written using the S4 object orientated system in R. The S4 system is a more formal and rigorous style of object orientated programming than the more commonly implemented S3. The process of defining a simulation involves the specification of many variables relating to the survey region, population, survey design and finally the analysis. The design of dsims is based around each of these descriptions being contained in its own class and the formal S4 class definition procedure ensures that the objects created are of the correct format for the simulation. As the objects created by dsims are instances of S4 classes, if the user wishes to access information within them the symbol used is slightly different. To access named parts of S3 objects the “$” symbol would be used, while for S4 objects the “@” symbol must be used. The following code demonstrates this.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load simulation package</span></span>
<span><span class="co">## library(DSsim)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DistanceDevelopment/dsims" class="external-link">dsims</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make a default region object</span></span>
<span><span class="co">## eg.region &lt;- make.region()</span></span>
<span><span class="va">eg.region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dssd/man/make.region.html" class="external-link">make.region</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's check the structure of the object we have created</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">eg.region</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Formal class 'Region' [package "dssd"] with 5 slots</span></span>
<span><span class="co">##   ..@ region.name: chr "region"</span></span>
<span><span class="co">##   ..@ strata.name: chr "region"</span></span>
<span><span class="co">##   ..@ units      : chr(0) </span></span>
<span><span class="co">##   ..@ area       : num 1e+06</span></span>
<span><span class="co">##   ..@ region     :Classes 'sf' and 'data.frame': 1 obs. of  2 variables:</span></span>
<span><span class="co">##   .. ..$ region  : chr "study_ar"</span></span>
<span><span class="co">##   .. ..$ geometry:sfc_POLYGON of length 1; first list element: List of 1</span></span>
<span><span class="co">##   .. .. ..$ : num [1:5, 1:2] 0 0 2000 2000 0 0 500 500 0 0</span></span>
<span><span class="co">##   .. .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"</span></span>
<span><span class="co">##   .. ..- attr(*, "sf_column")= chr "geometry"</span></span>
<span><span class="co">##   .. ..- attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA</span></span>
<span><span class="co">##   .. .. ..- attr(*, "names")= chr "region"</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If we wanted to extract the area of the region we would use</span></span>
<span><span class="va">eg.region</span><span class="op">@</span><span class="va">area</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1e+06</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="example-simulation-study-which-truncation-distance">Example Simulation Study: Which Truncation Distance?<a class="anchor" aria-label="anchor" href="#example-simulation-study-which-truncation-distance"></a>
</h3>
<p>It is usual in distance sampling studies to truncate the data at some distance from the transect. This is because the observations far away from the transect are of lesser importance when fitting the detection function and also these sparse observations at large distances could have high influence on model selection and possibly increase variability in estimated abundance / density.</p>
<p>Buckland et al. <span class="citation">(2001)</span> suggest truncating the data where the probability of detection is around 0.15 as a general rule of thumb. However, distance sampling data is often costly to obtain and discarding some of the data points can feel counter intuitive. In this vignette we investigate truncation distance in distance sampling analyses. We will do this through a series of three simulations outlined below.</p>
<p>Firstly, this vignette will investigate data generated assuming a simple half normal detection function where every object has the same probability of detection at a specific distance from the transect. Figure <a href="#fig:truncdists1">3</a> shows a simple half normal detection function with three possible truncation distances at <span class="math inline">\(1*\sigma\)</span>, <span class="math inline">\(2*\sigma\)</span> and <span class="math inline">\(3*\sigma\)</span> where <span class="math inline">\(\sigma\)</span> is the scale parameter of the half normal detection function. The truncation distance at <span class="math inline">\(2*\sigma\)</span> gives a probability of detection of 0.135 so close to the 0.15 rule of thumb.</p>
<div class="figure">
<span style="display:block;" id="fig:truncdists1"></span>
<img src="dsims-examples_files/figure-html/truncdists1-1.png" alt="Half-normal detection function showing 3 proposed truncation distances at $1*\sigma$, $2*\sigma$ and $3*\sigma$. The truncation distance at twice sigma gives a probability of detection of 0.135 so close to the 0.15 rule of thumb."><p class="caption">
Figure 3: Half-normal detection function showing 3 proposed truncation distances at <span class="math inline">\(1*\sigma\)</span>, <span class="math inline">\(2*\sigma\)</span> and <span class="math inline">\(3*\sigma\)</span>. The truncation distance at twice sigma gives a probability of detection of 0.135 so close to the 0.15 rule of thumb.
</p>
</div>
<p>While the first set of simulations assume a simple half normal detection function, in reality individual objects or clusters of objects will likely have varying probability of being detected based on certain characteristics. Perhaps the behaviour of males will make them easier to detect. It is also easy to see that larger clusters of individuals might be easier to spot at large distances than small clusters. We will also investigate the effects of truncation distance when individual level covariates affect the probability of detection. Figure <a href="#fig:truncdists2">4</a> shows how covariates may affect detectability. We will use simulated distance data with one covariate (sex) to investigate both the effects of truncation when we assume that we were not able to measure the covariate affecting detectability and when we assume that we can and therefore will include the relevant covariate in the detection function model.</p>
<div class="figure">
<span style="display:block;" id="fig:truncdists2"></span>
<img src="dsims-examples_files/figure-html/truncdists2-1.png" alt="Half-normal detection function which varies based on cluster size and animal sex."><p class="caption">
Figure 4: Half-normal detection function which varies based on cluster size and animal sex.
</p>
</div>
</div>
<div class="section level3">
<h3 id="model-uncertainty-and-pooling-robustness">Model Uncertainty and Pooling Robustness<a class="anchor" aria-label="anchor" href="#model-uncertainty-and-pooling-robustness"></a>
</h3>
<p>When we simulate data, we have to provide the detection function to generate detections, and we therefore know the underlying true detection function. When collecting data in the field, we will not have this information, and so we will have to rely on some form of model selection. One method of model selection is to compare information criterion, dsims allows the user to select either AIC, AICc or BIC as the model selection criteria. For these simulations we will use AIC and allow dsims to select between a half-normal and a hazard rate model in the first two sets of simulations.</p>
<p>In addition, if the probability of detection is affected by covariates then we may not only have a single underlying detection function but a combination of detection functions giving rise to our observed data. In this situation we can either model detectability as a function of these covariates or rely on a concept called pooling robustness. Pooling robustness refers to the fact that distance sampling techniques are robust to the pooling of multiple detection functions into one. This means that we do not necessarily need to include all the covariates which affect detectability in the detection function to accurately estimate density / abundance. This vignette will examine the concept of pooling robustness to see if it is affected by truncation distance.</p>
</div>
</div>
<div class="section level2">
<h2 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a>
</h2>
<p>This vignette will guide you through the steps to create and run a series of simulations to investigate the effects of varying truncation distance on both data generated from a simple half-normal detection function and from a detection function where detectability is affected by a covariate.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>First we load the dsims library.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## library(DSsim)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DistanceDevelopment/dsims" class="external-link">dsims</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulation-components">Simulation Components<a class="anchor" aria-label="anchor" href="#simulation-components"></a>
</h2>
<p>As detailed in <a href="#introduction-to-dsims">Introduction to dsims</a> a simulation comprises of a number of components. dsims is designed so that each of these components is defined individually before they are grouped together into a simulation. This helps keep the process clear and also allows reuse of simulation components between different simulations. Each of the function names to create a simulation component or simulation takes the form <em>make.&lt;component&gt;</em>.</p>
<div class="section level3">
<h3 id="region">Region<a class="anchor" aria-label="anchor" href="#region"></a>
</h3>
<p>These simulations will use a rectangular study region of 5 km by 20 km. Survey regions can be defined in any units but all units must be the same throughout the components of the simulation. If a shapefile is used to create the survey region, then information on the units will be taken from the .prj file. Here we will define the coordinates in m. As this is a simple study region (Figure <a href="#fig:region">5</a>) with few vertices we can simply provide the coordinates. A change from DSsim is that you now need to turn the coordinates into an sf polygon shape prior to creating the region. This step is documented below. Note that while standard shapefiles have their outer polygon coordinates given in a clockwise direction, sf uses counter clockwise for external polygons and clockwise for holes within polygons. Further details on creating multi-part or multi-strata sf objects can be found at the end of the <a href="https://examples.distancesampling.org/dssd-multi-strata/MultiStrataVignette-distill.html" class="external-link">multi-strata dssd vignette</a>.</p>
<p>You will also note that units are no longer a plotting option. The plot functions have been modified to use ggplot2 and if additional plotting options are desired the ggplot object can be captured and modified.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## # Create a polgon</span></span>
<span><span class="co">## poly1 &lt;- data.frame(x = c(0,0,20000,20000,0), y = c(0,5000,5000,0,0))</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## # Create an empty list</span></span>
<span><span class="co">## # Store the polygon inside a list in the first element of the coords list referring to strata 1.</span></span>
<span><span class="co">## coords &lt;- list()</span></span>
<span><span class="co">## coords[[1]] &lt;- list(poly1)</span></span>
<span></span>
<span><span class="co"># Create an sf polgon</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co"># Put the coordinates of the polygon in a matrix</span></span>
<span><span class="va">poly1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>, <span class="fl">20000</span>,<span class="fl">0</span>, <span class="fl">20000</span>,<span class="fl">5000</span>, <span class="fl">0</span>,<span class="fl">5000</span>, <span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fl">2</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Turn them into an sf polygon</span></span>
<span><span class="va">pl1</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">poly1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## # Create the survey region</span></span>
<span><span class="co">## region &lt;- make.region(region.name = "study area", </span></span>
<span><span class="co">##                       units = "m",</span></span>
<span><span class="co">##                       coords = coords)</span></span>
<span><span class="co">## # The plot function allows plotting in km or m.</span></span>
<span><span class="co">## plot(region, plot.units = "km")</span></span>
<span></span>
<span><span class="co"># Create the survey region</span></span>
<span><span class="va">region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dssd/man/make.region.html" class="external-link">make.region</a></span><span class="op">(</span>region.name <span class="op">=</span> <span class="st">"study area"</span>, </span>
<span>                      units <span class="op">=</span> <span class="st">"m"</span>,</span>
<span>                      shape <span class="op">=</span> <span class="va">pl1</span><span class="op">)</span></span>
<span><span class="co"># The plot function allows plotting in km or m.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">region</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:region"></span>
<img src="dsims-examples_files/figure-html/region-1.png" alt="The study region."><p class="caption">
Figure 5: The study region.
</p>
</div>
</div>
<div class="section level3">
<h3 id="population">Population<a class="anchor" aria-label="anchor" href="#population"></a>
</h3>
<p>We will now define our population within our study region. Firstly, we must describe the distribution of the population by defining a density surface. For these simulations we will assume a uniform distribution of animals throughout the study region. dsims will generate an sf grid describing the density surface for us if we provide the x (and optionally the y) spacing and a constant density value for the surface. If the y spacing is omitted it will be assumed to be equal to the x spacing. In this example the value of the constant is not important as we will generate animals based on a fixed population size rather than using the exact values in the density grid.</p>
<p>There are two argument name changes in the make.density function: <em>region.obj</em> is now <em>region</em> and <em>density.gam</em> is now <em>fitted model</em>. The <em>buffer</em> argument is no longer needed and there is now an option to supply a formula for density based on x and y using <em>density.formula</em>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## # Create the density surface</span></span>
<span><span class="co">## density &lt;- make.density(region.obj = region, </span></span>
<span><span class="co">##                         x.space = 100, </span></span>
<span><span class="co">##                         constant = 1)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## # Plot the density surface</span></span>
<span><span class="co">## plot(density, style = "blocks")</span></span>
<span><span class="co">## plot(region, add = TRUE)</span></span>
<span></span>
<span><span class="va">density</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make.density.html">make.density</a></span><span class="op">(</span>region <span class="op">=</span> <span class="va">region</span>, </span>
<span>                        x.space <span class="op">=</span> <span class="fl">100</span>, </span>
<span>                        constant <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the density surface</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">density</span>, <span class="va">region</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:density"></span>
<img src="dsims-examples_files/figure-html/density-1.png" alt="The density surface."><p class="caption">
Figure 6: The density surface.
</p>
</div>
<p>As an aside, if we wished to add areas of higher or lower density to our density surface we could do this using the <em>add.hotspot</em> function in dsims. This function adds these hot or low spots based on a Gaussian decay function. We have to provide the central coordinates and a sigma value to tell dsims about the location and shape of the hot/low spot. The amplitude argument gives the value of the hot or low spot at its centre and is combined with the existing density surface through addition.</p>
<p>The code used to do this in dsims is identical to that used with DSsim and so is not repeated in the code chunk below.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add a hotspot to the density surface, centre located at x = 15000, y = 4000 with </span></span>
<span><span class="co"># a Gaussian decay parameter sigma = 1500. The value at the centre point will now </span></span>
<span><span class="co"># be 1 (the current value of the density surface defined above) + 0.5 = 1.5</span></span>
<span><span class="va">eg.density</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add.hotspot-methods.html">add.hotspot</a></span><span class="op">(</span><span class="va">density</span>, centre <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15000</span>,<span class="fl">4000</span><span class="op">)</span>, sigma <span class="op">=</span> <span class="fl">1500</span>, amplitude <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="co"># Add a lowspot to this new density surface (eg.density)</span></span>
<span><span class="va">eg.density</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add.hotspot-methods.html">add.hotspot</a></span><span class="op">(</span><span class="va">eg.density</span>, centre <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10000</span>,<span class="fl">3000</span><span class="op">)</span>, sigma <span class="op">=</span> <span class="fl">1000</span>, amplitude <span class="op">=</span> <span class="op">-</span><span class="fl">0.25</span><span class="op">)</span></span>
<span><span class="co"># Plot the density surface</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">eg.density</span>, <span class="va">region</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:density2"></span>
<img src="dsims-examples_files/figure-html/density2-1.png" alt="The non-uniform density surface."><p class="caption">
Figure 7: The non-uniform density surface.
</p>
</div>
<p>We can now define other aspects of the population. For the simple case (with no covariates) we only need to define a fixed population size and provide the region and density grid we created above. This fixed population size of 200 was selected as a value sufficient to give around 100 detections per simulated survey while not so large as to cause the simulations to run more slowly. The minimum recommended number of detections for fitting a detection function to is 60 <span class="citation">(Buckland et al., 2001)</span>.</p>
<p>There are only minor argument names changes to this function: <em>region.obj</em> is now <em>region</em> and <em>density.obj</em> is now <em>density</em>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## # Create the population description, with a population size N = 200</span></span>
<span><span class="co">## pop.desc &lt;- make.population.description(region.obj = region, </span></span>
<span><span class="co">##                                             density.obj = density, </span></span>
<span><span class="co">##                                             N = 200,</span></span>
<span><span class="co">##                                             fixed.N = TRUE)</span></span>
<span></span>
<span><span class="co"># Create the population description, with a population size N = 200</span></span>
<span><span class="va">pop.desc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make.population.description.html">make.population.description</a></span><span class="op">(</span>region <span class="op">=</span> <span class="va">region</span>, </span>
<span>                                        density <span class="op">=</span> <span class="va">density</span>, </span>
<span>                                        N <span class="op">=</span> <span class="fl">200</span>,</span>
<span>                                        fixed.N <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>For our simulations involving covariates we need to define how individuals will be allocated these covariate values. dsims allows the user to either define their own discrete distribution or alternatively provide a distribution (Normal, Poisson, Zero-truncated Poisson or Lognormal) with associated parameters. For these simulation we will use sex as a covariate and assume that 50% of the population are female and 50% are male.</p>
<p>In this example the sex covariate is defined in exactly the same way as in DSsim.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create the covariate list</span></span>
<span><span class="va">covariate.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># The population will be 50% males and 50% females</span></span>
<span><span class="va">covariate.list</span><span class="op">$</span><span class="va">sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"female"</span>, <span class="st">"male"</span><span class="op">)</span>, </span>
<span>                                      prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## # Create the population description, with a population size N = 200</span></span>
<span><span class="co">## pop.desc.cov &lt;- make.population.description(region = region, </span></span>
<span><span class="co">##                                             density = density, </span></span>
<span><span class="co">##                                             covariates = covariate.list, </span></span>
<span><span class="co">##                                             N = 200)</span></span>
<span></span>
<span><span class="co"># Create the population description, with a population size N = 200</span></span>
<span><span class="va">pop.desc.cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make.population.description.html">make.population.description</a></span><span class="op">(</span>region <span class="op">=</span> <span class="va">region</span>, </span>
<span>                                            density <span class="op">=</span> <span class="va">density</span>, </span>
<span>                                            covariates <span class="op">=</span> <span class="va">covariate.list</span>, </span>
<span>                                            N <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span></code></pre></div>
<p>Note that when defining covariates using distributions the format has changed slightly. An example is included below. In dsims the format has been simplified in that the covariate distribution list provided for each stratum is now just a list with named elements ‘distribution’ and the distribution parameters. Please refer to the help for which parameters should be defined for each distribution and further examples.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## covariate.list &lt;- list()</span></span>
<span><span class="co">## covariate.list$size &lt;- list(list("poisson", list(lambda = 35)))</span></span>
<span></span>
<span><span class="va">covariate.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">covariate.list</span><span class="op">$</span><span class="va">size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>distribution <span class="op">=</span> <span class="st">"poisson"</span>, lambda <span class="op">=</span> <span class="fl">35</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="detectability">Detectability<a class="anchor" aria-label="anchor" href="#detectability"></a>
</h3>
<p>Detectability refers to the detection function or functions we feed into the simulation to generate the observations. In the simple case we can set all animals to have the same probability of detection given their distance from the transect. Here we define a half-normal detection function with scale parameter <span class="math inline">\(\sigma = 200\)</span> and data generation truncation distance of 1000. The truncation distance defined here is to aid simulation efficiency and means that no detections can occur beyond this value. We can then plot this function to check we have defined it correctly. As we defined our survey region in m the scale parameter and truncation distance will also be assumed to be in metres.</p>
<p>The scale parameter of 200 was selected as on average it gives around 100 detections out to a truncation distance of 1000m with our chosen population size of 200.</p>
<p>Defining detectability in dsims uses identical code to that in DSsim and so the code is not repeated here.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make a simple half normal detection function with a scale parameter of 200</span></span>
<span><span class="va">detect.hn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make.detectability.html">make.detectability</a></span><span class="op">(</span>key.function <span class="op">=</span> <span class="st">"hn"</span>,</span>
<span>                                 scale.param <span class="op">=</span> <span class="fl">200</span>, </span>
<span>                                 truncation <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="co"># We can now visualise these detection functions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">detect.hn</span>, <span class="va">pop.desc</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:detect1"></span>
<img src="dsims-examples_files/figure-html/detect1-1.png" alt="The detection functions for males and females."><p class="caption">
Figure 8: The detection functions for males and females.
</p>
</div>
<p>When we have covariates in the population we may choose to vary the scale parameter of the detection function based on the covariate values. dsims assumes that the scale parameter is a function of the covariates as follows:</p>
<p><span class="math display">\[ \sigma = exp(\beta_0+\sum_{j=1}^{q}\beta_{j}z_{ij}) \]</span></p>
<p>where <span class="math inline">\(\beta_0\)</span> is the log of the scale parameter supplied to <em>make.detectability</em>, the <span class="math inline">\(\beta_j\)</span>’s are the covariate parameters supplied on the log scale and <span class="math inline">\(z_{ij}\)</span> is the ith value of the jth covariate. This formula was taken from <span class="citation">Buckland et al. (2004)</span>.</p>
<p>The covariate values were selected so that males had a higher probability of detection than females. The values selected in this example give a sample size of around 150 observations out to the 1000m truncation value for our population of 200.</p>
<p>Defining detectability in dsims uses identical code to that in DSsim and so the code is not repeated here.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create the covariate parameter list</span></span>
<span><span class="va">cov.params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Note the covariate parameters are supplied on the log scale</span></span>
<span><span class="va">cov.params</span><span class="op">$</span><span class="va">sex</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"female"</span>, <span class="st">"male"</span><span class="op">)</span>, </span>
<span>                            param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">detect.cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make.detectability.html">make.detectability</a></span><span class="op">(</span>key.function <span class="op">=</span> <span class="st">"hn"</span> ,</span>
<span>                                 scale.param <span class="op">=</span> <span class="fl">120</span>,</span>
<span>                                 cov.param <span class="op">=</span> <span class="va">cov.params</span>, </span>
<span>                                 truncation <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This setup gives a scale parameter of around 120 for the females and 540 for </span></span>
<span><span class="co"># the males. We can calculate the sigma for the males using the formula above:</span></span>
<span><span class="co"># exp(log(scale.param) + sex.male)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">120</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1.5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 537.8027</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We can now visualise these detection functions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">detect.cov</span>, <span class="va">pop.desc.cov</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:detect2"></span>
<img src="dsims-examples_files/figure-html/detect2-1.png" alt="The detection functions for males and females."><p class="caption">
Figure 9: The detection functions for males and females.
</p>
</div>
</div>
<div class="section level3">
<h3 id="design">Design<a class="anchor" aria-label="anchor" href="#design"></a>
</h3>
<p>The design section of the simulations in dsims is the part which differs most significantly from DSsim. DSsim only generated very basic designs and anything more complex needed to be generated externally and loaded as shapefiles. dsims uses the dssd survey design package in R to specify designs and generate transects from them.</p>
<p>For this example we will use a systematic parallel line transect design. As the recommended minimum number of transects is between 10 and 20 <span class="citation">(Buckland et al., 2001)</span> we have set the spacing between the lines to be 1000 m to give 20 transects per survey.</p>
<p>For basic designs the arguments to the make.design function have only changed slightly: <em>region.obj</em> is now <em>region</em> and <em>design.details</em> is now <em>design</em>. Note, it is now important to define a truncation distance for the design, this allows design coverage to be assessed. dssd also now provides a more comprehensive set of arguments for defining designs. To investigate these further, please see our <a href="https://examples.distancesampling.org/dssd-getting-started/GettingStarted-distill.html" class="external-link">Getting Started with dssd vignette</a> and our <a href="https://examples.distancesampling.org/dssd-multi-strata/MultiStrataVignette-distill.html" class="external-link">Multiple Strata in dssd vignette</a>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## # Define the design</span></span>
<span><span class="co">## design &lt;- make.design(region.obj = region,</span></span>
<span><span class="co">##                       transect.type = "line",</span></span>
<span><span class="co">##                       design.details = c("parallel", "systematic"),</span></span>
<span><span class="co">##                       spacing = 1000)</span></span>
<span></span>
<span><span class="co"># Define the design</span></span>
<span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dssd/man/make.design.html" class="external-link">make.design</a></span><span class="op">(</span>region <span class="op">=</span> <span class="va">region</span>,</span>
<span>                      transect.type <span class="op">=</span> <span class="st">"line"</span>,</span>
<span>                      design <span class="op">=</span> <span class="st">"systematic"</span>,</span>
<span>                      spacing <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                      truncation <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
<p>The design objects now contain the survey region and so there is no need to supply this as a separate argument when generating transects. If you would like to plot the covered areas then the <em>covered.area</em> argument can be set to TRUE in the <em>plot</em> function, in this example the covered areas may not be obvious as the truncation distance is the same as the transect spacing.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## transects &lt;- generate.transects(design, region = region)</span></span>
<span><span class="co">## plot(region)</span></span>
<span><span class="co">## plot(transects, col = 4, lwd = 2)</span></span>
<span></span>
<span><span class="va">transects</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dssd/man/generate.transects-methods.html" class="external-link">generate.transects</a></span><span class="op">(</span><span class="va">design</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">region</span>, <span class="va">transects</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:transects"></span>
<img src="dsims-examples_files/figure-html/transects-1.png" alt="Example survey transects."><p class="caption">
Figure 10: Example survey transects.
</p>
</div>
</div>
<div class="section level3">
<h3 id="analysis">Analysis<a class="anchor" aria-label="anchor" href="#analysis"></a>
</h3>
<p>The final stage of the simulation is to analyse the distance sampling data that has been generated. As discussed above, when collecting data in the field we would not know the true underlying detection function and will therefore incorporate model uncertainty. We can ask the simulation to fit two models, a half-normal and a hazard rate, to the data and select the best model based on the minimum AIC.</p>
<p>There is a fairly substantial change to the syntax used to define the detection function models for the analyses as well as the function name itself. The syntax for DSsim was based on mrds which we felt was not as user friendly as the syntax used by the Distance R package <span class="citation">(Miller, Rexstad, Thomas, Marshall, &amp; Laake, 2019)</span>. We have therefore made the code in dsims more simililar to defining models for Distance.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## ddf.analyses &lt;- make.ddf.analysis.list(dsmodel = list(~cds(key = "hn", formula = ~1),</span></span>
<span><span class="co">##                                                       ~cds(key = "hr", formula = ~1)), </span></span>
<span><span class="co">##                                        method = "ds",</span></span>
<span><span class="co">##                                        truncation = 600)</span></span>
<span><span class="co">##                                        criteria = "AIC",</span></span>
<span></span>
<span><span class="va">ddf.analyses</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make.ds.analysis.html">make.ds.analysis</a></span><span class="op">(</span>dfmodel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span><span class="fl">1</span>, <span class="op">~</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                                 key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hn"</span>, <span class="st">"hr"</span><span class="op">)</span>,</span>
<span>                                 criteria <span class="op">=</span> <span class="st">"AIC"</span>,</span>
<span>                                 truncation <span class="op">=</span> <span class="fl">600</span><span class="op">)</span></span></code></pre></div>
<p>In this code we have set the truncation distance to 600 but later we will vary this value to investigate the effects of truncation distance on our simulation results. Note that while the truncation distance can be set to any value, it should not exceed the truncation value defined in the detectability or design as no observations will occur beyond these values.</p>
<p>In addition, in the field it may be possible to identify the covariates that affect detectability so we may wish to fit a detection function that incorporates this. In this case, the following model would be appropriate:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## ddf.analyses.cov &lt;- make.ddf.analysis.list(dsmodel = list(~mcds(key = "hn", formula = ~sex)), </span></span>
<span><span class="co">##                                            method = "ds",</span></span>
<span><span class="co">##                                            truncation = 600)</span></span>
<span></span>
<span><span class="va">ddf.analyses.cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make.ds.analysis.html">make.ds.analysis</a></span><span class="op">(</span>dfmodel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span><span class="va">sex</span><span class="op">)</span>,</span>
<span>                                     key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hn"</span><span class="op">)</span>,</span>
<span>                                     truncation <span class="op">=</span> <span class="fl">600</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="simulations">Simulations<a class="anchor" aria-label="anchor" href="#simulations"></a>
</h2>
<p>The simulation is created by grouping all these components together. We will create two simulations here, the first simple case will involve no difference in detectability between animals, the second will include the difference in detectability due to sex. Initially, we will only include the analyses which allow selection between a half-normal and hazard rate model, later we modify this to run a third set of simulations where we fit a detection function with sex included as a covariate.</p>
<p>Once we have created the simulation objects, it is a good idea to check that everything is as you intended. The function <em>run.survey</em> simulates a single survey and generates a set of transects and a population and then simulates the survey process to create a distance sampling data set. These can then be plotted (Figures <a href="#fig:checksim">11</a> and <a href="#fig:checksim2">12</a>).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## sim &lt;- make.simulation(reps = 999, </span></span>
<span><span class="co">##                        region.obj = region,</span></span>
<span><span class="co">##                        design.obj = design,</span></span>
<span><span class="co">##                        detectability.obj = detect.hn,</span></span>
<span><span class="co">##                        ddf.analyses.list = ddf.analyses)</span></span>
<span><span class="co">##                        population.description.obj = pop.desc,</span></span>
<span><span class="co">## # Produce simulation setup plots</span></span>
<span><span class="co">## check.sim.setup(sim)</span></span>
<span></span>
<span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make.simulation.html">make.simulation</a></span><span class="op">(</span>reps <span class="op">=</span> <span class="fl">999</span>, </span>
<span>                       design <span class="op">=</span> <span class="va">design</span>,</span>
<span>                       population.description <span class="op">=</span> <span class="va">pop.desc</span>,</span>
<span>                       detectability <span class="op">=</span> <span class="va">detect.hn</span>,</span>
<span>                       ds.analysis <span class="op">=</span> <span class="va">ddf.analyses</span><span class="op">)</span></span>
<span><span class="co"># Produce survey and plot it</span></span>
<span><span class="va">survey</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run.survey-methods.html">run.survey</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">survey</span>, <span class="va">region</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:checksim"></span>
<img src="dsims-examples_files/figure-html/checksim-1.png" alt="Example survey. Top left - an example set of transects. Top right - an example population. Bottom left - the detections from the transects. Bottom right - A histogram of the distances from these observations to the transect it was detected."><p class="caption">
Figure 11: Example survey. Top left - an example set of transects. Top right - an example population. Bottom left - the detections from the transects. Bottom right - A histogram of the distances from these observations to the transect it was detected.
</p>
</div>
<p>We will now create a second simulation object for the simulations with covariates. We can re-use the design component and then add in the new population description and detectability to include the sex covariate. Here we include the same non-covariate analyses but for the final set of simulations we will change this to fit the covariate detection function model.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## sim.cov &lt;- make.simulation(reps = 999, </span></span>
<span><span class="co">##                        region.obj = region,</span></span>
<span><span class="co">##                        design.obj = design,</span></span>
<span><span class="co">##                        population.description.obj = pop.desc.cov,</span></span>
<span><span class="co">##                        detectability.obj = detect.cov,</span></span>
<span><span class="co">##                        ddf.analyses.list = ddf.analyses)</span></span>
<span><span class="co">## # Produce simulation setup plots</span></span>
<span><span class="co">## check.sim.setup(sim.cov)</span></span>
<span></span>
<span><span class="va">sim.cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make.simulation.html">make.simulation</a></span><span class="op">(</span>reps <span class="op">=</span> <span class="fl">999</span>, </span>
<span>                       design <span class="op">=</span> <span class="va">design</span>,</span>
<span>                       population.description <span class="op">=</span> <span class="va">pop.desc.cov</span>,</span>
<span>                       detectability <span class="op">=</span> <span class="va">detect.cov</span>,</span>
<span>                       ds.analysis <span class="op">=</span> <span class="va">ddf.analyses</span><span class="op">)</span></span>
<span><span class="co"># Produce survey and plot it</span></span>
<span><span class="va">survey.cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run.survey-methods.html">run.survey</a></span><span class="op">(</span><span class="va">sim.cov</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">survey.cov</span>, <span class="va">region</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:checksim2"></span>
<img src="dsims-examples_files/figure-html/checksim2-1.png" alt="Example survey. Top left - an example set of transects. Top right - an example population. Bottom left - the detections from the transects. Bottom right - A histogram of the distances from these observations to the transect it was detected."><p class="caption">
Figure 12: Example survey. Top left - an example set of transects. Top right - an example population. Bottom left - the detections from the transects. Bottom right - A histogram of the distances from these observations to the transect it was detected.
</p>
</div>
<p>To check that our second simulation is correctly generating covariate values for our population we can examine the first few detections in the simulated distance data.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">survey.cov</span><span class="op">@</span><span class="va">dist.data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    object individual obs.Region.Label Sample.Label distance        x         y</span></span>
<span><span class="co">## 2       2          2       study area            1 439.6622 680.6209  833.2067</span></span>
<span><span class="co">## 15     15         13       study area            1 127.7175 113.2412 3562.4237</span></span>
<span><span class="co">## 16     16         14       study area            1 385.4299 626.3886 2696.8466</span></span>
<span><span class="co">## 36     36         35       study area            1 699.3118 940.2705 4044.2287</span></span>
<span><span class="co">## 47     47         45       study area            1 521.5709 762.5297  411.8589</span></span>
<span><span class="co">## 87     87         89       study area            1 349.0618 590.0205  710.0814</span></span>
<span><span class="co">##     sex Region.Label Effort  Area</span></span>
<span><span class="co">## 2  male   study area   5000 1e+08</span></span>
<span><span class="co">## 15 male   study area   5000 1e+08</span></span>
<span><span class="co">## 16 male   study area   5000 1e+08</span></span>
<span><span class="co">## 36 male   study area   5000 1e+08</span></span>
<span><span class="co">## 47 male   study area   5000 1e+08</span></span>
<span><span class="co">## 87 male   study area   5000 1e+08</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="running-simulations">Running Simulations<a class="anchor" aria-label="anchor" href="#running-simulations"></a>
</h2>
<p>To run simulations the syntax has changed slightly from <em>run</em> in DSsim to <em>run.simulations</em> in dsims and the <em>object</em> argument is now <em>simulation</em>. The simulations can still be run in parallel using <em>run.parallel</em> with the maximum cores set using <em>max.cores</em> and the <em>counter</em> argument is retained. The <em>transect.path</em> argument of the <em>run.simulation</em> function in dsims is where you can optionally supply a folder or filename if you wish to load pre-generated shapefiles (in DSsim this was specified in the design). This option is not expected to be widely used and was incorporated to allow simulations in Distance for Windows to be run using dsims.</p>
<p>Here we demonstrate how to run the basic simulation as an example. You will see the code to do this incorporated into the multiple simulations run within for loops in the following sections. Note that it is advisable to first run your simulation with a few iterations (&lt;10) to give an indication that it should run without issues before setting it off on hundreds / thousands repetitions. Once you have run a simulation you can view the results using the summary function which provides a glossary to explain the output. A histogram of the estimates of abundance can also be viewed, Figure <a href="#fig:simhist">13</a>.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## sim &lt;- run(object = sim)</span></span>
<span></span>
<span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run.simulation-methods.html">run.simulation</a></span><span class="op">(</span>simulation <span class="op">=</span> <span class="va">sim</span>, run.parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Display a summary of the simulation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span>
<span><span class="co"># Display a histogram of the estimates of abundance</span></span>
<span><span class="fu"><a href="../reference/histogram.N.ests-methods.html">histogram.N.ests</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## GLOSSARY</span></span>
<span><span class="co">## --------</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Summary of Simulation Output</span></span>
<span><span class="co">## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Region          : the region name.</span></span>
<span><span class="co">## No. Repetitions : the number of times the simulation was repeated.</span></span>
<span><span class="co">## No. Excluded Repetitions : the number of times the simulation failed</span></span>
<span><span class="co">##                   (too few sightings, model fitting failure etc.)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Summary for Individuals</span></span>
<span><span class="co">## ~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Summary Statistics:</span></span>
<span><span class="co">##    mean.Cover.Area : mean covered across simulation.</span></span>
<span><span class="co">##    mean.Effort     : mean effort across simulation.</span></span>
<span><span class="co">##    mean.n          : mean number of observed objects across</span></span>
<span><span class="co">##                      simulation.</span></span>
<span><span class="co">##    mean.n.miss.dist: mean number of observed objects where no distance</span></span>
<span><span class="co">##                     was recorded (only displayed if value &gt; 0).</span></span>
<span><span class="co">##    no.zero.n       : number of surveys in simulation where</span></span>
<span><span class="co">##                      nothing was detected (only displayed if value &gt; 0).</span></span>
<span><span class="co">##    mean.ER         : mean encounter rate across simulation.</span></span>
<span><span class="co">##    mean.se.ER      : mean standard error of the encounter rates</span></span>
<span><span class="co">##                      across simulation.</span></span>
<span><span class="co">##    sd.mean.ER      : standard deviation of the encounter rates</span></span>
<span><span class="co">##                      across simulation.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Estimates of Abundance:</span></span>
<span><span class="co">##    Truth            : true population size, (or mean of true</span></span>
<span><span class="co">##                       population sizes across simulation for Poisson N.</span></span>
<span><span class="co">##    mean.Estimate    : mean estimate of abundance across simulation.</span></span>
<span><span class="co">##    percent.bias     : the percentage of bias in the estimates.</span></span>
<span><span class="co">##    RMSE             : root mean squared error/no. successful reps</span></span>
<span><span class="co">##    CI.coverage.prob : proportion of times the 95% confidence interval</span></span>
<span><span class="co">##                       contained the true value.</span></span>
<span><span class="co">##    mean.se          : the mean standard error of the estimates of</span></span>
<span><span class="co">##                       abundance</span></span>
<span><span class="co">##    sd.of.means      : the standard deviation of the estimates</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Estimates of Density:</span></span>
<span><span class="co">##    Truth            : true average density.</span></span>
<span><span class="co">##    mean.Estimate    : mean estimate of density across simulation.</span></span>
<span><span class="co">##    percent.bias     : the percentage of bias in the estimates.</span></span>
<span><span class="co">##    RMSE             : root mean squared error/no. successful reps</span></span>
<span><span class="co">##    CI.coverage.prob : proportion of times the 95% confidence interval</span></span>
<span><span class="co">##                       contained the true value.</span></span>
<span><span class="co">##    mean.se          : the mean standard error of the estimates.</span></span>
<span><span class="co">##    sd.of.means      : the standard deviation of the estimates.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Detection Function Values</span></span>
<span><span class="co">## ~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  mean.observed.Pa : mean proportion of individuals/clusters observed in</span></span>
<span><span class="co">##                     the covered region.</span></span>
<span><span class="co">##  mean.estimte.Pa  : mean estimate of the proportion of individuals/</span></span>
<span><span class="co">##                     clusters observed in the covered region.</span></span>
<span><span class="co">##  sd.estimate.Pa   : standard deviation of the mean estimates of the</span></span>
<span><span class="co">##                     proportion of individuals/clusters observed in the</span></span>
<span><span class="co">##                     covered region.</span></span>
<span><span class="co">##  mean.ESW         : mean estimated strip width.</span></span>
<span><span class="co">##  sd.ESW           : standard deviation of the mean estimated strip widths.</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Region:  study area</span></span>
<span><span class="co">## No. Repetitions:  999</span></span>
<span><span class="co">## No. Excluded Repetitions:  0</span></span>
<span><span class="co">## Using only repetitions where all models converged.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Design:  Systematic parallel line design</span></span>
<span><span class="co">##    design.type :  Systematic parallel line design</span></span>
<span><span class="co">##    bounding.shape :  rectangle</span></span>
<span><span class="co">##    spacing :  1000</span></span>
<span><span class="co">##    design.angle :  0</span></span>
<span><span class="co">##    edge.protocol :  minus</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Population Detectability Summary:</span></span>
<span><span class="co">##     key.function  =  hn</span></span>
<span><span class="co">##     scale.param  =  200</span></span>
<span><span class="co">##     truncation  =  1000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Analysis Summary:</span></span>
<span><span class="co">##    Candidate Models:</span></span>
<span><span class="co">##       Model 1: key function 'hn', formula '~1', was selected 798 time(s).</span></span>
<span><span class="co">##       Model 2: key function 'hr', formula '~1', was selected 201 time(s).</span></span>
<span><span class="co">##    criteria  =  AIC</span></span>
<span><span class="co">##    variance.estimator  =  R2</span></span>
<span><span class="co">##    truncation  =  600</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Summary for Individuals</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Summary Statistics</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   mean.Cover.Area mean.Effort   mean.n mean.k      mean.ER   mean.se.ER</span></span>
<span><span class="co">## 1         1.2e+08       1e+05 99.11311     20 0.0009911311 9.838211e-05</span></span>
<span><span class="co">##     sd.mean.ER</span></span>
<span><span class="co">## 1 7.436991e-05</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span><span class="co">## Estimates of Abundance (N)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Truth mean.Estimate percent.bias  RMSE CI.coverage.prob mean.se sd.of.means</span></span>
<span><span class="co">## 1   200        198.33        -0.84 26.17             0.94   25.36       26.13</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span><span class="co">## Estimates of Density (D)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Truth mean.Estimate percent.bias         RMSE CI.coverage.prob      mean.se</span></span>
<span><span class="co">## 1 2e-06  1.983281e-06   -0.8359462 2.617061e-07        0.9379379 2.535869e-07</span></span>
<span><span class="co">##    sd.of.means</span></span>
<span><span class="co">## 1 2.613023e-07</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span><span class="co">##      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Detection Function Values</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   mean.observed.Pa mean.estimate.Pa sd.estimate.Pa mean.ESW sd.ESW</span></span>
<span><span class="co">## 1             0.42             0.42           0.05   252.75  27.29</span></span></code></pre>
<div class="figure">
<span style="display:block;" id="fig:simhist"></span>
<img src="dsims-examples_files/figure-html/simhist-1.png" alt="Histogram of abundance estimates from the simulation."><p class="caption">
Figure 13: Histogram of abundance estimates from the simulation.
</p>
</div>
<p>If your goal was to simply learn the syntax for switching from DSsim to dsims then you can finish here. The remainder of this vignette loops through further simulations to test how altering truncation distance affects pooling robustness and covariate parameter estimation. From now on only dsims code will be shown.</p>
</div>
<div class="section level2">
<h2 id="running-multiple-simulations-to-investigate-truncation">Running Multiple Simulations to investigate Truncation<a class="anchor" aria-label="anchor" href="#running-multiple-simulations-to-investigate-truncation"></a>
</h2>
<p>To investigate the effects of varying the truncation distance during analysis we do not simply need to run one simulation, but one for each truncation distance. The following code shows how we iterated over a number of different truncation distances and stored the simulation with its results and the simulation summaries as lists. In this first set of simulations detectability does not change with individual level covariates.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Truncation distances to iterate over</span></span>
<span><span class="va">truncation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">400</span>, <span class="fl">600</span><span class="op">)</span></span>
<span><span class="co"># Storage space for results</span></span>
<span><span class="va">results.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">summary.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We will now run the simulation for each of the analysis truncation distances.</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">tdist</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>along<span class="op">=</span> <span class="va">truncation</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># Screen display to indicate how far through the simulations we are</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n Running for truncation = "</span>, <span class="va">truncation</span><span class="op">[</span><span class="va">tdist</span><span class="op">]</span>, fill <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="co"># Update analysis with new truncation distance</span></span>
<span>  <span class="va">new.ds.analyses</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make.ds.analysis.html">make.ds.analysis</a></span><span class="op">(</span>dfmodel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span><span class="fl">1</span>, <span class="op">~</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                                      key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hn"</span>, <span class="st">"hr"</span><span class="op">)</span>,</span>
<span>                                      criteria <span class="op">=</span> <span class="st">"AIC"</span>,</span>
<span>                                      truncation <span class="op">=</span> <span class="va">truncation</span><span class="op">[</span><span class="va">tdist</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="co"># Update simulation to include new analysis component</span></span>
<span>  <span class="co"># We can use the @ symbol to change the contents of a slot or alternatively we could have</span></span>
<span>  <span class="co"># re-created the simulation with the new analyses using make.simulation().</span></span>
<span>  <span class="va">sim</span><span class="op">@</span><span class="va">ds.analysis</span> <span class="op">&lt;-</span> <span class="va">new.ds.analyses</span></span>
<span>  <span class="co"># Run simulation and store the results in the appropriate list element</span></span>
<span>  <span class="va">results.list</span><span class="op">[[</span><span class="va">tdist</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run.simulation-methods.html">run.simulation</a></span><span class="op">(</span><span class="va">sim</span>, run.parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="co"># Store simulation summary in another list in the appropriate list element</span></span>
<span>  <span class="co"># As we are storing the summary we do not need the description.summary displayed</span></span>
<span>  <span class="va">summary.list</span><span class="op">[[</span><span class="va">tdist</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">results.list</span><span class="op">[[</span><span class="va">tdist</span><span class="op">]</span><span class="op">]</span>, description.summary <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Add names to the summary and results list so we know which truncation distance they</span></span>
<span><span class="co"># relate to</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">results.list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"t"</span>, <span class="va">truncation</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">summary.list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"t"</span>, <span class="va">truncation</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p>We will now move on to investigate what happens when the sex covariate affects detectability. First, we need to select suitable candidate truncation distances; to do this we will plot some example data. Figure <a href="#fig:checksim2">12</a> shows data generated from a population size of 2500, this increase in population size will increase the number of detections and make the shape of the resulting data less variable. From this histogram five candidate truncation distances were selected and are shown by the red vertical lines. These were selected so that the truncation distances represent a range of values for the probability of detection starting at about 0.6 for the shortest truncation distance.</p>
<div class="figure">
<span style="display:block;" id="fig:covtruncation"></span>
<img src="dsims-examples_files/figure-html/covtruncation-1.png" alt="Histogram of data from covariate simulation with an increased population size of 2500. The detection function shows the best fit to the data (the code was allowed to select between a half normal and hazard rate based on minimum AIC). The red lines indicate the manually selected candidate truncation distances."><p class="caption">
Figure 14: Histogram of data from covariate simulation with an increased population size of 2500. The detection function shows the best fit to the data (the code was allowed to select between a half normal and hazard rate based on minimum AIC). The red lines indicate the manually selected candidate truncation distances.
</p>
</div>
<p>We can now feed these candidate truncation distances into our covariate simulations in the same way as we did for the simple half normal simulation and again store the results and summaries as lists. Note that for now we are still fitting the half-normal and hazard rate intercept only models and are therefore testing pooling robustness.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Truncation distances to iterate over</span></span>
<span><span class="va">truncation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">400</span>, <span class="fl">600</span>, <span class="fl">800</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="co"># Storage space for results</span></span>
<span><span class="va">cov.results.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">cov.summary.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">tdist</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>along<span class="op">=</span> <span class="va">truncation</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># Screen display to indicate how far through the simulations we are</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n Running for truncation = "</span>, <span class="va">truncation</span><span class="op">[</span><span class="va">tdist</span><span class="op">]</span>, fill <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="co"># Update analysis truncation distance</span></span>
<span>  <span class="va">new.ds.analyses</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make.ds.analysis.html">make.ds.analysis</a></span><span class="op">(</span>dfmodel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span><span class="fl">1</span>, <span class="op">~</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                                      key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hn"</span>, <span class="st">"hr"</span><span class="op">)</span>,</span>
<span>                                      criteria <span class="op">=</span> <span class="st">"AIC"</span>,</span>
<span>                                      truncation <span class="op">=</span> <span class="va">truncation</span><span class="op">[</span><span class="va">tdist</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="co"># Update simulation</span></span>
<span>  <span class="va">sim.cov</span><span class="op">@</span><span class="va">ds.analysis</span> <span class="op">&lt;-</span> <span class="va">new.ds.analyses</span></span>
<span>  <span class="co"># Run Simulation</span></span>
<span>  <span class="va">cov.results.list</span><span class="op">[[</span><span class="va">tdist</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run.simulation-methods.html">run.simulation</a></span><span class="op">(</span><span class="va">sim.cov</span>, run.parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="co"># Store simulation summaries</span></span>
<span>  <span class="va">cov.summary.list</span><span class="op">[[</span><span class="va">tdist</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cov.results.list</span><span class="op">[[</span><span class="va">tdist</span><span class="op">]</span><span class="op">]</span>, description.summary <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Add names to the summary and results list</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cov.results.list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"t"</span>, <span class="va">truncation</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cov.summary.list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"t"</span>, <span class="va">truncation</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we may also wish to fit the covariate model we used to generate the data rather than the non covariate half-normal and hazard rate models. This will allow us to investigate the effects of truncation if in fact we were aware of and could “measure” the covariate that we knew to be affecting detectability.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Now include the ddf.analyses.cov in the simulation</span></span>
<span><span class="va">sim.cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make.simulation.html">make.simulation</a></span><span class="op">(</span>reps <span class="op">=</span> <span class="fl">999</span>, </span>
<span>                           design <span class="op">=</span> <span class="va">design</span>,</span>
<span>                           population.description <span class="op">=</span> <span class="va">pop.desc.cov</span>,</span>
<span>                           detectability <span class="op">=</span> <span class="va">detect.cov</span>,</span>
<span>                           ds.analysis <span class="op">=</span> <span class="va">ddf.analyses.cov</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Truncation distances to iterate over</span></span>
<span><span class="va">truncation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">400</span>, <span class="fl">600</span>, <span class="fl">800</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Storage space for results</span></span>
<span><span class="va">covmod.results.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">covmod.summary.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">tdist</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>along<span class="op">=</span> <span class="va">truncation</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># Screen display to indicate how far through the simulations we are</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n Running for truncation = "</span>, <span class="va">truncation</span><span class="op">[</span><span class="va">tdist</span><span class="op">]</span>, fill <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="co"># Update analysis truncation distance so that detecability is now modelled as a function of sex</span></span>
<span>  <span class="va">new.ds.analyses</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make.ds.analysis.html">make.ds.analysis</a></span><span class="op">(</span>dfmodel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span><span class="va">sex</span><span class="op">)</span>,</span>
<span>                                      key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hn"</span><span class="op">)</span>,</span>
<span>                                      truncation <span class="op">=</span> <span class="va">truncation</span><span class="op">[</span><span class="va">tdist</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="co"># Update simulation</span></span>
<span>  <span class="va">sim.cov</span><span class="op">@</span><span class="va">ds.analysis</span> <span class="op">&lt;-</span> <span class="va">new.ds.analyses</span></span>
<span>  <span class="co"># Run Simulation</span></span>
<span>  <span class="va">covmod.results.list</span><span class="op">[[</span><span class="va">tdist</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run.simulation-methods.html">run.simulation</a></span><span class="op">(</span><span class="va">sim.cov</span>, run.parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="co"># Store simulation summaries</span></span>
<span>  <span class="va">covmod.summary.list</span><span class="op">[[</span><span class="va">tdist</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">covmod.results.list</span><span class="op">[[</span><span class="va">tdist</span><span class="op">]</span><span class="op">]</span>, description.summary <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Add names to the summary and results list</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">covmod.results.list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"t"</span>, <span class="va">truncation</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">covmod.summary.list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"t"</span>, <span class="va">truncation</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="running-simulations-to-check-detection-function-parameter-estimates">Running Simulations to Check Detection Function Parameter Estimates<a class="anchor" aria-label="anchor" href="#running-simulations-to-check-detection-function-parameter-estimates"></a>
</h2>
<p>The above simulations concentrate on the question of how accurately and precisely we can estimate the abundance and density of a population. However, we may also be interested in learning how individual level covariates affect detectability. To do this we require a different and slightly more advanced setup. dsims does not currently store the detection function parameter estimates therefore we need to do this manually, however dsims does provide functionality so that doing this is fairly straight forward. As before we create our simulation but then we need to get dsims to give us the survey data so that we can run the analyses and obtain the parameter estimates. Please note that the extraction of the parameter estimates from the ddf model is specific to this model, if you are adapting this code you will need to check the ddf documentation in mrds to understand the parameters for different models.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim.cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make.simulation.html">make.simulation</a></span><span class="op">(</span>reps <span class="op">=</span> <span class="fl">999</span>, </span>
<span>                       design <span class="op">=</span> <span class="va">design</span>,</span>
<span>                       population.description <span class="op">=</span> <span class="va">pop.desc.cov</span>,</span>
<span>                       detectability <span class="op">=</span> <span class="va">detect.cov</span>,</span>
<span>                       ds.analysis <span class="op">=</span> <span class="va">ddf.analyses.cov</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Truncation distances to iterate over</span></span>
<span><span class="va">truncation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">400</span>, <span class="fl">600</span>, <span class="fl">800</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">reps</span> <span class="op">&lt;-</span> <span class="va">sim.cov</span><span class="op">@</span><span class="va">reps</span></span>
<span></span>
<span><span class="co"># To store values of interest</span></span>
<span><span class="va">sigma.est</span> <span class="op">&lt;-</span> <span class="va">male.param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="cn">NA</span>, </span>
<span>                                 dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">truncation</span><span class="op">)</span>, <span class="va">reps</span><span class="op">)</span>, </span>
<span>                                 dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">truncation</span>, <span class="fl">1</span><span class="op">:</span><span class="va">reps</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Iterate over truncation distances</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">tdist</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">{</span><span class="co">#seq(along = truncation)){</span></span>
<span>  <span class="co"># Screen display to indicate how far through the simulations we are</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n Running for truncation = "</span>, <span class="va">truncation</span><span class="op">[</span><span class="va">tdist</span><span class="op">]</span>, fill <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="co"># Update truncation distance</span></span>
<span>  <span class="va">new.ds.analyses</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make.ds.analysis.html">make.ds.analysis</a></span><span class="op">(</span>dfmodel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span><span class="va">sex</span><span class="op">)</span>,</span>
<span>                                      key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hn"</span><span class="op">)</span>,</span>
<span>                                      truncation <span class="op">=</span> <span class="va">truncation</span><span class="op">[</span><span class="va">tdist</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="co"># Update simulation</span></span>
<span>  <span class="va">sim.cov</span><span class="op">@</span><span class="va">ds.analysis</span> <span class="op">&lt;-</span> <span class="va">new.ds.analyses</span></span>
<span>  <span class="co"># Simulation repetitions</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">reps</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\r"</span>, <span class="va">i</span>, <span class="st">" out of "</span>, <span class="va">reps</span>,  <span class="st">" reps \r"</span><span class="op">)</span></span>
<span>    <span class="co"># Simulates the survey process </span></span>
<span>    <span class="va">simulated.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run.survey-methods.html">run.survey</a></span><span class="op">(</span><span class="va">sim.cov</span><span class="op">)</span></span>
<span>    <span class="co"># Run analyses </span></span>
<span>    <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse.data-methods.html">analyse.data</a></span><span class="op">(</span><span class="va">new.ds.analyses</span>, <span class="va">simulated.data</span><span class="op">)</span></span>
<span>    <span class="co"># Obtain detection function model</span></span>
<span>    <span class="va">ddf.results</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">ddf</span></span>
<span>    <span class="co"># Store values of interest</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="va">sigma.est</span><span class="op">[</span><span class="va">tdist</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">ddf.results</span><span class="op">$</span><span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="va">male.param</span><span class="op">[</span><span class="va">tdist</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">ddf.results</span><span class="op">$</span><span class="va">par</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h2>
<p>As these simulations take a substantial amount of time to run we have saved the results and summaries; these can be downloaded as <a href="dsims_truncation_results.zip">dsims_truncation_results.zip</a>. Running one of these simulations with 999 repetitions for one truncation distance takes about 11 minutes on an i7-2600K 3.40GHz processor when running in parallel across 7 threads. When running in parallel the maximum number of cores (or threads) permitted is one less than the number on the machine, this is the default number used unless max.cores specifies a lower number.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Running simulations in parallel</span></span>
<span><span class="fu"><a href="../reference/run.simulation-methods.html">run.simulation</a></span><span class="op">(</span><span class="va">sim.cov</span>, run.parallel <span class="op">=</span> <span class="cn">TRUE</span>, max.cores <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<p>Once they have been downloaded and unzipped into a sub folder called results the results and summaries can be loaded as follows:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulations using a simple half normal detection function</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"results/results_list.ROBJ"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"results/summary_list.ROBJ"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Covartiate simulations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"results/results_cov_list.ROBJ"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"results/summary_cov_list.ROBJ"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Covariate simulations with covariate model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"results/covmod_results_list.ROBJ"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"results/covmod_summary_list.ROBJ"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"results/sigma_est.ROBJ"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"results/male_param.ROBJ"</span><span class="op">)</span></span></code></pre></div>
<p>The objects this has loaded into the workspace include <em>results.list</em>, <em>summary.list</em>, <em>cov.results.list</em>, <em>cov.summary.list</em>, <em>covmod.results.list</em>, <em>covmod.summary.list</em>, <em>sigma_est</em> and <em>male_param</em>. <em>results.list</em> is a list of 3 simulation objects for the simple half normal simulations with truncation distances of 200, 400 and 600. <em>summary.list</em> is a list of the 3 simulation summaries associated with simulations in <em>results.list</em>. <em>cov.results.list</em> is a list of 5 simulation objects for the covariate simulations where detectability is affected by sex but sex is not included as a covariate in the detection function models. These simulations relate to truncation distances of 200, 400, 600, 800 and 1000. <em>cov.summary.list</em> is a list of the 5 simulation summaries associated with simulations in <em>cov.results.list</em>. <em>covmod.results.list</em> is a list of 5 simulation objects for the covariate simulations where detectability is affected by sex and with the analyses including the covariate sex in the detection function model. These simulations relate to truncation distances of 200, 400, 600, 800 and 1000. <em>covmod.summary.list</em> is a list of the 5 simulation summaries associated with simulations in <em>covmod.results.list</em>. <em>sigma_est</em> and <em>male_param</em> contains the parameter estimates from the same simulation set up as <em>covmod.summary.list</em>. <em>sigma_est</em> is a 2D array containing parameter estimates for sigma for the five truncation distances and <em>male_param</em> contains the parameter estimates for the male sex parameter for each truncation distance.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># To view the full summary for the simple half normal simulation with a truncation distance of 200:</span></span>
<span><span class="va">summary.list</span><span class="op">$</span><span class="va">t200</span></span>
<span></span>
<span><span class="co"># To view the full summary for the covariate simulation with a truncation distance of 600:</span></span>
<span><span class="va">cov.summary.list</span><span class="op">$</span><span class="va">t600</span></span></code></pre></div>
<div class="section level3">
<h3 id="extracting-result-statistics">Extracting Result Statistics<a class="anchor" aria-label="anchor" href="#extracting-result-statistics"></a>
</h3>
<p>To investigate how truncation distance affects the results we need to produce tables for comparison. This section details how this can be done using knitr. This section is provided for those interested but users can just skip to the next section where the results tables are actually presented. This code is only applicable to study regions which only have one strata, it would need to be modified to deal with multiple strata.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">N</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">summary.list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span><span class="op">@</span><span class="va">individuals</span><span class="op">$</span><span class="va">N</span><span class="op">$</span><span class="va">mean.Estimate</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">n</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">summary.list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span><span class="op">@</span><span class="va">individuals</span><span class="op">$</span><span class="va">summary</span><span class="op">$</span><span class="va">mean.n</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">se</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">summary.list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span><span class="op">@</span><span class="va">individuals</span><span class="op">$</span><span class="va">N</span><span class="op">$</span><span class="va">mean.se</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sd.N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">summary.list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span><span class="op">@</span><span class="va">individuals</span><span class="op">$</span><span class="va">N</span><span class="op">$</span><span class="va">sd.of.means</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bias</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">summary.list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span><span class="op">@</span><span class="va">individuals</span><span class="op">$</span><span class="va">N</span><span class="op">$</span><span class="va">percent.bias</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">RMSE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">summary.list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span><span class="op">@</span><span class="va">individuals</span><span class="op">$</span><span class="va">N</span><span class="op">$</span><span class="va">RMSE</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cov</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">summary.list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span><span class="op">@</span><span class="va">individuals</span><span class="op">$</span><span class="va">N</span><span class="op">$</span><span class="va">CI.coverage.prob</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>trunc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>,<span class="fl">400</span>,<span class="fl">600</span><span class="op">)</span>, </span>
<span>                       n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,</span>
<span>                       N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>,</span>
<span>                       se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">se</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>                       sd.N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">sd.N</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>                       bias <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">bias</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>                       RMSE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">RMSE</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>                       cov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">cov</span><span class="op">*</span><span class="fl">100</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">sim.data</span>, </span>
<span>      col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"$Truncation$"</span>, <span class="st">"$mean\\ n$"</span>, <span class="st">"$mean\\ \\hat{N}$"</span>, <span class="st">"$mean\\ se$"</span>, <span class="st">"$SD(\\hat{N})$"</span>, <span class="st">"$\\% Bias$"</span>, <span class="st">"$RMSE$"</span>, <span class="st">"$\\%\\ CI\\ Coverage$"</span><span class="op">)</span>,</span>
<span>      row.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      align <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'c'</span>, <span class="st">'c'</span>, <span class="st">'c'</span>, <span class="st">'c'</span>, <span class="st">'c'</span>, <span class="st">'c'</span>, <span class="st">'c'</span>, <span class="st">'c'</span><span class="op">)</span>,</span>
<span>      caption <span class="op">=</span> <span class="st">"Simulation Results for the simple half normal detection probability: The truncation distance, mean number of detections, mean estimated population size (N), mean standard error of $\\hat{N}$, the standard deviation of $\\hat{N}$, percentage bias, root mean squared error, percentage of times the true value of N was captured in the confidence intervals."</span>,</span>
<span>      table.placement<span class="op">=</span><span class="st">"!h"</span>,</span>
<span>      format <span class="op">=</span> <span class="st">"html"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="simulation-results">Simulation Results<a class="anchor" aria-label="anchor" href="#simulation-results"></a>
</h2>
<div class="section level3">
<h3 id="simple-half-normal-simulations">Simple Half-Normal Simulations<a class="anchor" aria-label="anchor" href="#simple-half-normal-simulations"></a>
</h3>
<p>For the simulations where the data were generated based on a single half-normal detection function the truncation distance used at the analysis stage made little difference to the estimates of abundance. There was perhaps some small decrease in coverage of the 95% confidence intervals as truncation distance was increased. A truncation distance of 400 or 600 didn’t quite capture truth 95% of the time, Table 1. The root mean squared error (RMSE) values suggested that the further away from the transect the distances were truncated the closer the abundance estimates were to truth, although bias appeared minimal for all three scenarios. Precision looked to improve with larger truncation distances.</p>
<table class="table">
<caption>
<span id="tab:maketables1">Table 1: </span>Simulation Results for the simple half normal detection probability. The truncation distance, mean number of detections, mean estimated population size (N), mean standard error of <span class="math inline">\(\hat{N}\)</span>, the standard deviation of <span class="math inline">\(\hat{N}\)</span>, percentage bias, root mean squared error, percentage of times the true value of N was captured in the 95% confidence intervals.
</caption>
<thead><tr>
<th style="text-align:center;">
<span class="math inline">\(Truncation\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(mean\ n\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(mean\ \hat{N}\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(mean\ se\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(SD(\hat{N})\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(\% Bias\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(RMSE\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(\%\ CI\ Coverage\)</span>
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:center;">
200
</td>
<td style="text-align:center;">
68
</td>
<td style="text-align:center;">
203
</td>
<td style="text-align:center;">
33.72
</td>
<td style="text-align:center;">
33.50
</td>
<td style="text-align:center;">
1.43
</td>
<td style="text-align:center;">
33.61
</td>
<td style="text-align:center;">
95.5
</td>
</tr>
<tr>
<td style="text-align:center;">
400
</td>
<td style="text-align:center;">
95
</td>
<td style="text-align:center;">
201
</td>
<td style="text-align:center;">
29.12
</td>
<td style="text-align:center;">
33.34
</td>
<td style="text-align:center;">
0.71
</td>
<td style="text-align:center;">
33.35
</td>
<td style="text-align:center;">
93.1
</td>
</tr>
<tr>
<td style="text-align:center;">
600
</td>
<td style="text-align:center;">
99
</td>
<td style="text-align:center;">
198
</td>
<td style="text-align:center;">
25.39
</td>
<td style="text-align:center;">
26.13
</td>
<td style="text-align:center;">
-1.11
</td>
<td style="text-align:center;">
26.21
</td>
<td style="text-align:center;">
93.8
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="covariate-simulation-testing-pooling-robustness">Covariate Simulation Testing Pooling Robustness<a class="anchor" aria-label="anchor" href="#covariate-simulation-testing-pooling-robustness"></a>
</h3>
<p>These simulations test whether or not we can rely on our assumption of pooling robustness in this situation. We have deliberately not provided the model used to generate the data as a candidate model in the analysis stage. We can see that for this setup, when we have pooled two quite distinct detection functions, there is some bias in the abundance estimates when the truncation distance is larger, Table 2. These results also show that our 95% confidence intervals capture the true abundance substantially less than 95% of the time when we use large truncation distances. This could be down to an underestimation of the variability, Table 2 shows that for large truncation values the mean se (mean of the estimated standard errors) is lower than the standard deviation of the estimates of abundance. If the analyses were correctly estimating the variability we would expected these values to be similar. In addition, the RMSE suggests that the larger the truncation distance the further away from truth the abundance estimates become, with the most significant jump between 800 and 1000m.</p>
<table class="table">
<caption>
<span id="tab:maketables2">Table 2: </span>Simulation Results for the covariate detection probability, where detectability is affected by sex but the candidate models (half-normal and hazard rate) do not contain covariates. The truncation distance, mean number of detections, mean estimated population size (N), mean standard error of <span class="math inline">\(\hat{N}\)</span>, the standard deviation of <span class="math inline">\(\hat{N}\)</span>, percentage bias, root mean squared error, percentage of times the true value of N was captured in the 95% confidence intervals.
</caption>
<thead><tr>
<th style="text-align:center;">
<span class="math inline">\(Truncation\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(mean\ n\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(mean\ \hat{N}\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(mean\ se\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(SD(\hat{N})\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(\% Bias\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(RMSE\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(\%\ CI\ Coverage\)</span>
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:center;">
200
</td>
<td style="text-align:center;">
66
</td>
<td style="text-align:center;">
199
</td>
<td style="text-align:center;">
34.25
</td>
<td style="text-align:center;">
34.98
</td>
<td style="text-align:center;">
-0.49
</td>
<td style="text-align:center;">
34.97
</td>
<td style="text-align:center;">
96.4
</td>
</tr>
<tr>
<td style="text-align:center;">
400
</td>
<td style="text-align:center;">
102
</td>
<td style="text-align:center;">
190
</td>
<td style="text-align:center;">
31.36
</td>
<td style="text-align:center;">
34.69
</td>
<td style="text-align:center;">
-5.12
</td>
<td style="text-align:center;">
36.16
</td>
<td style="text-align:center;">
90.6
</td>
</tr>
<tr>
<td style="text-align:center;">
600
</td>
<td style="text-align:center;">
128
</td>
<td style="text-align:center;">
188
</td>
<td style="text-align:center;">
33.94
</td>
<td style="text-align:center;">
35.95
</td>
<td style="text-align:center;">
-5.84
</td>
<td style="text-align:center;">
37.78
</td>
<td style="text-align:center;">
78.7
</td>
</tr>
<tr>
<td style="text-align:center;">
800
</td>
<td style="text-align:center;">
144
</td>
<td style="text-align:center;">
191
</td>
<td style="text-align:center;">
34.85
</td>
<td style="text-align:center;">
37.17
</td>
<td style="text-align:center;">
-4.43
</td>
<td style="text-align:center;">
38.19
</td>
<td style="text-align:center;">
79.6
</td>
</tr>
<tr>
<td style="text-align:center;">
1000
</td>
<td style="text-align:center;">
154
</td>
<td style="text-align:center;">
187
</td>
<td style="text-align:center;">
31.68
</td>
<td style="text-align:center;">
40.97
</td>
<td style="text-align:center;">
-6.41
</td>
<td style="text-align:center;">
42.91
</td>
<td style="text-align:center;">
69.7
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="covariate-simulation-with-covariate-model">Covariate Simulation with Covariate Model<a class="anchor" aria-label="anchor" href="#covariate-simulation-with-covariate-model"></a>
</h3>
<p>Finally we ran simulations and fitted the model we used to generate the data. In these simulations truncation distance had little influence on the accuracy of the estimates of abundance, with the exception of a small amount of bias for the smallest truncation distance, Table 3. The RMSE values suggest that the larger truncation distances did a better job at estimating abundance with the most significant improvement coming with the step from 200m truncation to 400m truncation. The 95% confidence intervals captured the true abundance at least 95% of the time for all truncation distances. In these simulations, the variability was always over estimated with the mean of the estimated standard errors always being higher than the standard deviation of the estimates.</p>
<p>While the estimates of abundance are not greatly affected by truncation distance for these simulations, the same cannot be said for the parameter estimates. Figure <a href="#fig:makeplots">15</a>, suggests that parameter estimation is most accurate and reliable at maximum truncation distance. The unstable parameter estimates for the smallest truncation distance leading to sometimes very large estimates of sigma and a bimodal distribution for sex.male could explain the slight bias in abundance estimates for this truncation distance seen in Table 2. It is hoped that in practise this strange behaviour might be associated with a poor fit to the data and would be identified and such estimates rejected based on more extensive model selection criteria.</p>
<table class="table">
<caption>
<span id="tab:maketables3">Table 3: </span>Simulation Results for the covariate detection probability, where detectability is affected by sex and this is modelled in the detection function. The truncation distance, mean number of detections, mean estimated population size (N), mean standard error of <span class="math inline">\(\hat{N}\)</span>, the standard deviation of the <span class="math inline">\(\hat{N}\)</span>, percentage bias, root mean squared error, percentage of times the true value of N was captured in the 95% confidence intervals.
</caption>
<thead><tr>
<th style="text-align:center;">
<span class="math inline">\(Truncation\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(mean\ n\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(mean\ \hat{N}\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(mean\ se\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(SD(\hat{N})\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(\% Bias\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(RMSE\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(\%\ CI\ Coverage\)</span>
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:center;">
200
</td>
<td style="text-align:center;">
66
</td>
<td style="text-align:center;">
208
</td>
<td style="text-align:center;">
36.14
</td>
<td style="text-align:center;">
28.57
</td>
<td style="text-align:center;">
3.76
</td>
<td style="text-align:center;">
29.52
</td>
<td style="text-align:center;">
98.0
</td>
</tr>
<tr>
<td style="text-align:center;">
400
</td>
<td style="text-align:center;">
102
</td>
<td style="text-align:center;">
204
</td>
<td style="text-align:center;">
29.46
</td>
<td style="text-align:center;">
23.85
</td>
<td style="text-align:center;">
1.81
</td>
<td style="text-align:center;">
24.11
</td>
<td style="text-align:center;">
98.5
</td>
</tr>
<tr>
<td style="text-align:center;">
600
</td>
<td style="text-align:center;">
128
</td>
<td style="text-align:center;">
202
</td>
<td style="text-align:center;">
27.78
</td>
<td style="text-align:center;">
22.16
</td>
<td style="text-align:center;">
1.15
</td>
<td style="text-align:center;">
22.27
</td>
<td style="text-align:center;">
97.8
</td>
</tr>
<tr>
<td style="text-align:center;">
800
</td>
<td style="text-align:center;">
144
</td>
<td style="text-align:center;">
202
</td>
<td style="text-align:center;">
26.97
</td>
<td style="text-align:center;">
20.66
</td>
<td style="text-align:center;">
0.88
</td>
<td style="text-align:center;">
20.73
</td>
<td style="text-align:center;">
98.5
</td>
</tr>
<tr>
<td style="text-align:center;">
1000
</td>
<td style="text-align:center;">
154
</td>
<td style="text-align:center;">
202
</td>
<td style="text-align:center;">
26.52
</td>
<td style="text-align:center;">
20.97
</td>
<td style="text-align:center;">
0.85
</td>
<td style="text-align:center;">
21.03
</td>
<td style="text-align:center;">
98.4
</td>
</tr>
</tbody>
</table>
<div class="figure">
<span style="display:block;" id="fig:makeplots"></span>
<img src="dsims-examples_files/figure-html/makeplots-1.png" alt="Histograms of the parameter estimates for sigma and sex.male for three of the five truncation distances investigated. Red lines indicate truth."><p class="caption">
Figure 15: Histograms of the parameter estimates for sigma and sex.male for three of the five truncation distances investigated. Red lines indicate truth.
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="discussion">Discussion<a class="anchor" aria-label="anchor" href="#discussion"></a>
</h2>
<p>In these simulations we have pushed the concept of pooling robustness to the limit in that our two detection functions for males and females were very distinct from one another. This would have increased the potential for spiked data in our simulations, that is when the number of detections falls away quickly at small distances and can make fitting the detection function unreliable (and in fact there were numerous warnings when running some of the simulations about such a scenario). The recommendation when performing distance sampling surveys is to review your data frequently in the field as it is being collected. If you detect spiked data then field methods should be adapted to achieve a wider shoulder in the detection function. This practise will help ensure that pooling robustness holds.</p>
<p>The model selection (if any) applied in these simulations was done purely on the basis of AIC. In practise the AIC value is one of a number of diagnostic techniques researchers rely on to select an appropriate detection function model. It is likely, especially due to the potential for spiked data, that some of the models in these simulations were not good fits to the data and would not have been selected by a researcher. If model selection would have been manual then a researcher may have chosen to include adjustment terms in the half-normal or hazard rate models which may have improved the model fit and associated estimates of abundance when relying on pooling robustness.</p>
<p>These simulations do suggest that there is only a small cost in precision to the researcher in truncating the data. In fact, truncation may be beneficial if there are large differences in the underlying detection functions due to a covariate which have not been included in the detection function models. We suspect that this is because when there are multiple detection functions pooled together the tails of the observed combined detection function only represent some of these detection functions while other have already dropped to extremely low probabilities of detection closer to the transect. It is a general rule in distance sampling that the shape of the detection function close to the transect is of more importance that what is going on in the tail. And indeed detections made at large distances, if included, can have an undesired large influence on detection function parameters. The generally accepted rule of thumb is to truncate data where the probability of detection is around 0.15.</p>
<p>Conversely, if the researcher hopes to identify which covariates affect detectability and obtain reliable parameter estimates then minimal (if any) truncation appears to be preferable.</p>
<p>The effects of truncation distance on estimated abundance precision are interesting, especially the comparison between our estimated and observed variability. When we only allow the simulations to fit the half-normal and hazard rate models but detectability if affected by the sex covariate, as truncation distance increases the estimated variability (mean se) stays roughly the same while the observed variability <span class="math inline">\((SD(\hat{N}))\)</span> increases. So at larger truncation distances the variability in our estimated abundance is underestimated and our confidence interval coverage is low. However, when fitting the covariate model our estimated variance is higher than our observed variance suggesting that for this model we are over estimating variability for all truncation distances and our confidence interval coverage is high.</p>
</div>
<div class="section level2">
<h2 id="conclusions">Conclusions<a class="anchor" aria-label="anchor" href="#conclusions"></a>
</h2>
<ul>
<li>Truncation can help ensure the concept of pooling robustness holds when there are differences in the detection functions of the individuals in the population and the covariates affecting detectability are not modelled.</li>
<li>The estimates of abundance are more accurate and precise when the covariate affecting detectability is included in the detection function model.</li>
<li>Larger truncation distances or no truncation is preferable when trying to accurately obtain the parameters for the covariates that affect detectability.</li>
</ul>
</div>
<div class="section level2 unnumbered">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0" line-spacing="2">
<div id="ref-Buckland2001vm" class="csl-entry">
Buckland, S. T., Anderson, D. R., Burnham, K. P., Borchers, D. L., &amp; Thomas, L. (2001). <em>Introduction to distance sampling</em>. Oxford University Press, Oxford, UK.
</div>
<div id="ref-Buckland2004ts" class="csl-entry">
Buckland, S. T., Anderson, D. R., Burnham, K. P., Laake, J. L., Borchers, D. L., &amp; Thomas, L. (2004). <em>Advanced distance sampling</em>. Oxford University Press.
</div>
<div id="ref-dssimpkg" class="csl-entry">
Marshall, L. (2019). <em>DSsim: Distance sampling simulations</em>. Retrieved from <a href="https://CRAN.R-project.org/package=DSsim" class="external-link">https://CRAN.R-project.org/package=DSsim</a>
</div>
<div id="ref-dsimspkg" class="csl-entry">
Marshall, L. (2022a). <em>Dsims: Distance sampling simulations</em>. Retrieved from <a href="https://CRAN.R-project.org/package=dsims" class="external-link">https://CRAN.R-project.org/package=dsims</a>
</div>
<div id="ref-dssdpkg" class="csl-entry">
Marshall, L. (2022b). <em>Dssd: Distance sampling survey design</em>. Retrieved from <a href="https://CRAN.R-project.org/package=dssd" class="external-link">https://CRAN.R-project.org/package=dssd</a>
</div>
<div id="ref-Distancepkg" class="csl-entry">
Miller, D. L., Rexstad, E., Thomas, L., Marshall, L., &amp; Laake, J. L. (2019). Distance sampling in <span>R</span>. <em>Journal of Statistical Software</em>, <em>89</em>(1), 1–28. <a href="https://doi.org/10.18637/jss.v089.i01" class="external-link">https://doi.org/10.18637/jss.v089.i01</a>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>We improve our site and software support by using Microsoft Clarity to see <br> how you use our website. By using our site, you agree that we and Microsoft <br> can collect and use this data. Clarity is GDPR compliant.</p>
</div>

<div class="pkgdown-footer-right">
  <p>If you wish to donate to development and maintenance</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
